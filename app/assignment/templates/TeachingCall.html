<div class="container">
	<div class="col-sm-10 col-sm-offset-1">
		<h2 class="page-header text-center">
			Teaching Call {{ year }}-{{ nextYear }}: {{ activeWorkgroup.name }}
			<small class="glyphicon glyphicon-question-sign" aria-hidden="true" tooltip-placement="right"
				uib-tooltip="Select the courses you plan to teach for the given term in the order of preference">
			</small>
		</h2>
		<table class="table teaching-call">
			<colgroup>
				<col ng-repeat="term in ::terms track by $index" span="1"
					ng-style="{ 'width' : 100 / terms.length + '%' }">
			</colgroup>
			<tbody>
				<tr>
					<th ng-repeat="term in ::view.state.activeTeachingCall.terms track by $index"
					disable-element="isScheduleTermLocked(term)">
						{{ getTermName(term) }}
					</th>
				</tr>
				<tr>
					<td ng-repeat="term in ::view.state.activeTeachingCall.terms track by $index"
					disable-element="isScheduleTermLocked(term)">
						<ol drag-end="updatePreferencesOrder(sortedIds, term)"
						read-only="isScheduleTermLocked(term)" class="sortable-list">
							<!-- id values needed to calculate the reordering of preferences in this specific format -->
							<li id="pref-{{ preference.id }}" class="unsortable"
							ng-repeat="preference in view.state.activeTeachingCall.termAssignments[termToTermCode(term)] | orderBy: 'priority' track by preference.id">
								<div term-preferences
								instructor-id="view.state.userInterface.instructorId"
								preference="preference"
								on-select="addPreference(preference, courseOffering, isBuyout, isSabbatical, isCourseRelease)"
								on-delete="removePreference(preference)"
								on-update="refreshPreferences()"
								schedule-id="activeTeachingCall.scheduleId"
								term="term"
								ng-if="!isScheduleTermLocked(term) && !preference.approved"></div>

								<div uib-tooltip="Preference has been approved"
								term-preferences
								instructor-id="instructorId"
								preference="preference"
								courses="courseOfferings[term]"
								schedule-id="teachingCall.scheduleId"
								term="term"
								on-select="updatePreference(preference, courseOffering, isBuyout, isSabbatical, isCourseRelease)"
								on-delete="deletePreference(preference)"
								on-update="refreshPreferences()"
								ng-if="isScheduleTermLocked(term) || preference.approved"
								read-only="isScheduleTermLocked(term) || preference.approved"></div>
								
							</li>

							<li ng-if="!teachingCallResponse[term].isComplete && !isScheduleTermLocked(term)"
								term-preferences courses="courseOfferings[term]" term="term" schedule-id="teachingCall.scheduleId" class="unsortable"
								instructor-id="instructorId"
								hidden-course-offering-ids="{{ getCourseOfferingIdsFromPreferences(termPreferences[term]) }}"
								hidden-courses="{{ getCoursesFromPreferences(termPreferences[term]) }}"
								on-update="refreshPreferences()"
								on-select="addPreference(courseOffering, term, isBuyout, isSabbatical, isCourseRelease)">
							</li>
						</ol>
					</td>
				</tr>
				<tr ng-if="view.state.activeTeachingCall.showUnavailabilities">
					<td colspan="{{ terms.length }}">
						<h2 class="page-header text-center">
							Unavailabilities
							<small class="glyphicon glyphicon-question-sign" aria-hidden="true" tooltip-placement="right"
								uib-tooltip="Highlight the blocks of time you are not available">
							</small>
							<small class="legend">
								<div class="legend-square" style="background-color:#fff"></div>Available
								<div class="legend-square" style="background-color:#ccc"></div>Unavailable
							</small>
						</h2>
					</td>
				</tr>
				<tr style="text-align:center;" ng-if="teachingCall.showUnavailabilities">
					<td ng-repeat="term in ::view.state.activeTeachingCall.terms track by $index" disable-element="isScheduleTermLocked(term)" style="font-weight: bold;">
						{{ getTermName(term) }}
						<span class="glyphicon glyphicon-transfer text-primary clickable hovrable" uib-tooltip="Copy to all terms"
							confirm-button="copyUnabailabilitiesToAllTerms(teachingCallResponse[term].availabilityBlob)"
							message="Are you sure you want to copy this term availabilities to all other terms?
								This will overwrite exisiting availabilities."
							yes="Confirm" no="Cancel" placement="top"></span>
					</td>
				</tr>
				<tr ng-if="view.state.activeTeachingCall.showUnavailabilities">
					<td ng-repeat="term in ::terms track by $index" disable-element="isScheduleTermLocked(term)">
						<availability-grid blob="teachingCallResponse[term].availabilityBlob"
							on-change="saveTeachingCallResponse(term, blob, 3000)"
							read-only="teachingCallResponse[term].isComplete" ></availability-grid>
					</td>
				</tr>
				<tr>
					<td colspan="{{ terms.length }}">
						<textarea class="form-control" rows="5" ng-model="teachingCallReceipt.comment"
							placeholder="Comments" auto-input on-blur="updateTeachingCallReceipt()">
						</textarea>
					</td>
				</tr>
				<tr>
					<td colspan="{{ terms.length }}">
						<div class="col-xs-offset-3 col-xs-6">
							<button type="button" class="btn btn-default btn-block"
							 confirm-button="updateTeachingCallReceipt(true)"
							 confirm-is-enabled="!teachingCallReceipt.isDone"
							 btn-class="btn-primary"
							 message="Are you sure you want to submit the preferences for this term?"
							 yes="Confirm" no="Cancel" placement="top">
								{{ teachingCallReceipt.isDone ? 'Update Preferences' : 'Submit Preferences' }}
							</button>
						</div>
						<div class="col-xs-3 text-muted" style="font-size: 80%;" ng-if="viewState.lastSaved">
							<span class="text-success">Auto saved at {{ viewState.lastSaved }}</span><br />
							It is safe to leave this page and continue later.
						</div>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	<!-- .col-xs-12 -->

</div>
<!-- /row -->
