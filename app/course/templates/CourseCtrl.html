<nav year="{{ year }}" term-code="{{ termCode }}" workgroup-code="{{ workgroupCode }}"></nav>

<div class="main-content" unselect-cell>

	<h3 style="text-align: center;">{{ sharedState.workgroup.name }} {{year}} Courses</h3>
	<br />

	<div class="row" style="margin-bottom: 2em;">
		<div class="col-sm-offset-3 col-sm-6">
			<input type="search" class="form-control" placeholder="Search" />
		</div>
	</div>

	<div class="row">
		<div class="col-sm-12">
			<div class="table-toolbar">
				<div class="btn-group">
					<span class="tool-icon glyphicon glyphicon-list-alt" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
					<ul class="dropdown-menu" multiselect-dropdown items="termDefinitions" active-ids="view.state.filters.enabledTerms" toggle-item="termToggled(id)" ></ul>
				</div> <!-- .btn-group -->

				<div class="btn-group">
					<span class="tool-icon glyphicon glyphicon-filter" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
					<ul class="dropdown-menu">
						<li><a href="#" class="small" data-value="option1" tabIndex="-1"><input type="checkbox"/>&nbsp;&nbsp;Undergraduate</a></li>
						<li><a href="#" class="small" data-value="option1" tabIndex="-1"><input type="checkbox"/>&nbsp;&nbsp;Graduate</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="#" class="small" data-value="option1" tabIndex="-1"><input type="checkbox"/>&nbsp;&nbsp;Published Courses</a></li>
						<li><a href="#" class="small" data-value="option1" tabIndex="-1"><input type="checkbox"/>&nbsp;&nbsp;Unpublished Courses</a></li>
					</ul>
				</div> <!-- .btn-group -->

				<div class="btn-group">
					<span class="tool-icon glyphicon glyphicon-download-alt" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
					<ul class="dropdown-menu">
						<li><a href="#" class="small">as Excel</a></li>
						<li><a href="#" class="small">as CSV</a></li>
					</ul>
				</div> <!-- .btn-group -->

				<span class="tool-icon glyphicon glyphicon-print" data-toggle="tooltip" data-placement="top" title="" data-original-title="Print"></span>
			</div>
		</div>
	</div>

	<table course-table class="table table-bordered courses-table"></table>

</div>

<div class="fixed right-details">
	<div class="panel panel-primary panel-highlight" ng-if="view.selectedEntity">
		<div class="panel-heading">
			<div class="panel-title">
				<h4 ng-if="view.selectedEntityType == 'course' && !view.state.courses.newCourse">
					{{ view.selectedEntity.subjectCode }} {{ view.selectedEntity.courseNumber 	}}
					<br>
					<small>{{ view.selectedEntity.title }}</small>
				</h4>
				<h4 ng-if="view.state.courses.newCourse">
					New Course
				</h4>
				<h4 ng-if="view.selectedEntityType == 'sectionGroup'"
					ng-init="parentCourse = view.state.courses.list[view.selectedEntity.courseId]">
					{{ parentCourse.subjectCode }} {{ parentCourse.courseNumber }}
					<br>
					<small>{{ view.selectedEntity.termCode.getTermCodeDisplayName() }}</small>
				</h4>
			</div>

			<div class="panel-options">
				<a ng-click="closeDetails()"><i class="entypo-cancel"></i></a>
			</div>
		</div>

		<div class="panel-body no-padding">
			<div class="course-details" ng-if="view.selectedEntityType == 'course'">
				<form role="form" class="form-horizontal form-groups-bordered">
					<div class="right-details-group">
						<div class="row" ng-if="!view.state.courses.newCourse">
							<div class="col-sm-10 col-sm-offset-1">
								<strong>Title</strong>
								<br />
								<input type="text" class="form-control course-title-edit" ng-model="view.selectedEntity.title">
							</div>
						</div>
						<div class="row" ng-if="view.state.courses.newCourse">
							<div class="col-sm-10 col-sm-offset-1">
								<strong>Course</strong>
								<br />
								<input type="text" ng-model="selectedCourse" placeholder="Search courses"
												uib-typeahead="course as (course.subjectCode + ' ' + course.courseNumber + ' ' + course.title) for course in searchCourses($viewValue)"
												typeahead-loading="loadingCourses"
												typeahead-no-results="noResults"
												typeahead-wait-ms="400"
												typeahead-min-length="2"
												typeahead-on-select="searchCoursesResultSelected($item, $model, $label, $event)"
												class="form-control">
							</div>
						</div>
					</div>
					<div class="right-details-group" ng-if="!view.state.courses.newCourse">
						<div class="row">
							<div class="col-sm-10 col-sm-offset-1">
								<strong>Tags</strong>
								<br />

								<ui-select multiple ng-model="view.selectedEntity.tagIds" theme="bootstrap"
								close-on-select="false" on-select="addTag($item, $model)" on-remove="removeTag($item, $model)">
									<ui-select-match placeholder="Select tags...">{{view.state.tags.list[$item].name}}</ui-select-match>
									<!-- TODO: needs custom filter -->
									<ui-select-choices repeat="tagId in view.state.tags.ids | filter:$select.search">
										<div ng-bind-html="view.state.tags.list[tagId].name | highlight: $select.search"></div>
									</ui-select-choices>
								</ui-select>

							</div>
						</div>
					</div>
					<div class="right-details-group">
						<div class="row">
							<label class="col-sm-3 col-sm-offset-1 control-label">Sequence</label>
							<div class="col-sm-7">
								<input type="text" ng-model="view.selectedEntity.sequencePattern"
												uib-typeahead="sequencePattern for sequencePattern in sequencePatterns | filter:$viewValue | limitTo:8"
												typeahead-loading="loadingSequences"
												typeahead-no-results="noResults"
												typeahead-wait-ms="400"
												typeahead-min-length="2"
												typeahead-editable="false"
												class="form-control course-sequence-pattern">
							</div>
						</div>
					</div>
					<div class="right-details-group" ng-if="view.state.courses.newCourse">
						<div class="row">
							<div class="col-sm-10 col-sm-offset-1 ">
								<button type="button" class="btn btn-white" ng-click="closeDetails()">Cancel</button>
								<button type="button" class="btn btn-blue pull-right" ng-click="createCourse()"
									ng-class="{ 'disabled': !newCourseIsValid() }"
									uib-tooltip="All fields are required"
									tooltip-enable="!newCourseIsValid()">
										Create
								</button>
							</div>
						</div>
					</div>

				</form>
			</div>
			<div class="section-group-details" style="padding: 1em;"
				ng-class="{ 'visible': view.selectedEntityType == 'sectionGroup' }">
				<sg-chart sg="view.selectedEntity"></sg-chart>
				<hr />
				<table class="table sections-table">
					<colgroup>
						<col span="1" style="width: 34%;">
						<col span="1" style="width: 33%;">
						<col span="1" style="width: 33%;">
					</colgroup>
					<thead>
						<tr>
							<th>Section</th>
							<th>Enrollment</th>
							<th>Seats</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="section in view.selectedEntity.sections track by section.id">
							<td>{{ section.sequence }}</td>
							<td>{{ section.enrollment }}</td>
							<td><input type="text" class="form-control" ng-model="section.seats"></td>
						</tr>
						<tr ng-if="view.selectedEntity.isSeries && view.selectedEntity.isActive">
							<td><a>{{ nextSequence(view.selectedEntity) }}</a></td>
							<td></td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>

</div>
